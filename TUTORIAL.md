<h1>SMIRP tutorial</h1>

This tutorial demonstrates how to run the full SMIRP pipeline in order to build a species-specific model using species-specific positive and negative data sets, and to use this model to predict test data.

All scripts mentioned in this tutorial are located in the base smirp directory. All data files generated by these scrips are placed in the smirp/data directory.

<h1>Part 0: Installing SMIRP dependencies</h1>

SMIRP requires the ViennaRNA Perl library to be installed, as well as the Shuffle and StdDev algorithms for Perl.

Running Ubuntu, the ViennaRNA package can be installed using the following commands:

sudo apt-add-repository ppa:j-4/vienna-rna
sudo apt-get update 
sudo apt-get install vienna-rna

The Shuffle and StdDev algorithms can be installed using cpan (the Comprehensive Perl Archive Network) using the following commands:

cpan Algorithm::Numerical::Shuffle
cpan Statistics::Basic::StdDev

<h1>Part 1: Building a species-specific model</h1>

<h2>Step 1: Retrieving coding region data</h2>

In order to build a species-specific model for miRNA prediction, positive and negative training data is required.

Negative training data is extracted from coding region sequences. These sequences can be downloaded from the European Nucleotide Archive (http://www.ebi.ac.uk/ena). Search for a species which is a close phylogenetic relative to your species of interest, and retrieve coding region data for this species in fasta format. We recommend retrieving at least 5000 coding region sequences.

Once a coding region fasta file has been retrieved, place this file in the smirp <i>data</i> folder.

Positive (miRbase) data is provided with SMIRP and does not need to be retrieved.

<h2>Step 2: Building a positive data set</h2>

In order to build a positive training set, use the build_positiveset.py script. This script will generate a file which contains HeteroMirPred feature data for miRNA sequences which are present in large miRNA clusters, and which are selected from species which are closely phylogenetically related to your target species.

The build_positiveset.py script requires two inputs:
	The species name of the species within miRbase which is most closely related to your target species -s
	An output file name -o

Optionally, you can determine the number of data points in your data set, using the -n option. The default for this option is 1000.

For example, you can build a positive training data set using Xenopus tropicalis as our reference species with the following command:

python build_positiveset.py -s "Xenopus tropicalis" -o xtropicalis_positive.hmp20 -n 600

<h2>Step 3: Extracting hairpin regions from negative coding regions</h2>

Sequences which form miRNA-like hairpin structures form the negative training set for the species-specific model. These sequences must be extracted from the coding region sequences retrieved in step 1, using the extract_hairpins.py script. This script requires two inputs: 
	Input fasta file -i
	Number of concurrent threads -n

In order to produce a negative set with a specific number of hairpins, the size of the negative set can be specified using the -h option. This many 

Optionally, one can set the MFE threshold and base pair requirements for miRNA-like hairpins, and maximum base pair distance using the -m, -p, and -l options. If you wish to cluster negative results at a specific similarity threshold, use the -c option with the desired threshold (between 0.8 and 1)

For example, in order to extract 1000 hairpins from the provided ENA coding region fasta file <i>xtropicalis_coding.fa</i> using 6 concurrent threads, use the following command:

python extract_hairpins.py -i xtropicalis_coding.fa -n 6 -h 1000

This script will generate a file with the .nr.hairpins extension, which contains a set of hairpins in fasta format.

<h2>Step 4: Building HeteroMirPred features for your negative data set</h2>

HeteroMirPred features can be built for any fasta file containing hairpin sequences, using the build_hmp_features.py script. This script requires three inputs:
	An input fasta file name -i
	Number of concurrent threads -n
	Class, either 'miRNA' or 'pseudo' -c

For example, in order to build the HMP feature set for your sample coding region data (using 6 threads), you would use the following command:

python build_hmp_features.py -i coding_regions.fa.nr.hairpins -n 6 -c pseudo

The resulting HeteroMirPred feature file will be placed in the data folder with the .hmp20 extension, <i>e.g.</i> coding_regions.fa.nr.hairpins.hmp20.

Note: Several warning messages appear during this step. These warnings are a matter of course during HeteroMirPred feature creation and do not affect the creation of the feature file.

<h2>Step 5: Building a model using species-specific training data</h2>

With positive and negative training data files in the data directory, a species-specific model can be built using the build_model.py script. This script requires three inputs:
	Positive data set file name -p
	Negative data set file name -n
	Output model name -o

Once this script is completed, two model files will be present in the <i>smirp/models/</i> directory, with the .model and .scale extensions. Your model is now completed, and you can now predict any hairpins using your new model.

Following the ongoing example, if you wish to build a model using the data sets generated in steps 3 and 4, you can use the following command:

python build_model.py -p xtropicalis_positive.hmp20 -n xtropicalis_coding.fa.nr.hairpins.hmp20 -o xtropicalis

<h1>Part 2: Predicting miRNA using a species-specific model</h1>

<h2>Step 1: Extract hairpins (optional)</h2>

If you are looking to predict the presence of miRNA within the context of a larger genomic sequence, you can use the extract_hairpins.py script, as detailed above, in order to extract miRNA-like hairpin sequences from larger RNA or DNA sequences. If you do not specify any value for the -h (number of hairpins) option, the resulting hairpin file will contain all hairpins present in the input fasta file.

<h2>Step 2: Build HeteroMirPred features</h2>

If you are looking to predict a set of miRNA-like hairpins, or have previously extracted hairpins from genomic regions of interest, the build_hmp_features.py script is required to generate the HeteroMirPred features which will be used by the species-specific model for prediction. The build_hmp_features.py script is described in Step 4 of Part 1 of the tutorial.

<h2>Step 3: Predict miRNA</h2>

You can use a classification model to predict a HeteroMirPred feature file using the predict.py script. This script requires two inputs:
	Model name -m
	Input feature file -i

This script outputs a file in the smirp/data/ directory with the .results extension.

<h2>Step 4: Format results (optional)</h2>

Formatted files which contain header, sequence, and prediction data together can be produced with the format_results.py script. Thie script requires three inputs:
	Fasta file containing hairpin sequences -f
	HeteroMirPred result filename -r
	Output filename -o

This script will produce a formatted output file with the given name in the smirp/data/ directory.